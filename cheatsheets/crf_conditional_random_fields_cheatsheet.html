<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>CRF (Conditional Random Fields) Cheatsheet ‚Äî 3 –∫–æ–ª–æ–Ω–∫–∏</title>
  <style>
    @media screen {body {font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;color: #333;background: #fafcff;padding: 10px;}}
    @media print {body {background: white;padding: 0;}@page {size: A4 landscape;margin: 10mm;}}
    .container {column-count: 3;column-gap: 20px;max-width: 100%;}
    .block {break-inside: avoid;margin-bottom: 1.2em;padding: 12px;background: white;border-radius: 6px;box-shadow: 0 1px 3px rgba(0,0,0,0.05);}
    h1 {font-size: 1.6em;font-weight: 700;color: #1a5fb4;text-align: center;margin: 0 0 8px;column-span: all;}
    .subtitle {text-align: center;color: #666;font-size: 0.9em;margin-bottom: 12px;column-span: all;}
    h2 {font-size: 1.15em;font-weight: 700;color: #1a5fb4;margin: 0 0 8px;padding-bottom: 4px;border-bottom: 1px solid #e0e7ff;}
    p, ul, ol {font-size: 0.92em;margin: 0.6em 0;}
    ul, ol {padding-left: 18px;}
    li {margin-bottom: 4px;}
    code {font-family: 'Consolas', 'Courier New', monospace;background-color: #f0f4ff;padding: 1px 4px;border-radius: 3px;font-size: 0.88em;}
    pre {background-color: #f0f4ff;padding: 8px;border-radius: 4px;overflow-x: auto;font-size: 0.84em;margin: 6px 0;}
    pre code {padding: 0;background: none;white-space: pre-wrap;}
    table {width: 100%;border-collapse: collapse;font-size: 0.82em;margin: 6px 0;}
    th {background-color: #e6f0ff;text-align: left;padding: 4px 6px;font-weight: 600;}
    td {padding: 4px 6px;border-bottom: 1px solid #f0f4ff;}
    tr:nth-child(even) {background-color: #f8fbff;}
    blockquote {font-style: italic;margin: 8px 0;padding: 6px 10px;background: #f8fbff;border-left: 2px solid #1a5fb4;font-size: 0.88em;}
    @media print {.container {column-gap: 12px;}.block {box-shadow: none;}code, pre, table {font-size: 0.78em;}h1 {font-size: 1.4em;}h2 {font-size: 1em;}}
  </style>
</head>
<body>
<div class="container">
  <h1>üè∑Ô∏è CRF (Conditional Random Fields)</h1>
  <div class="subtitle">üìÖ –Ø–Ω–≤–∞—Ä—å 2026</div>
  
  <div class="block">
    <h2>üî∑ 1. –°—É—Ç—å</h2>
    <ul>
      <li><strong>CRF</strong>: Conditional Random Fields</li>
      <li><strong>–ó–∞–¥–∞—á–∞</strong>: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ (NER, POS tagging)</li>
      <li><strong>–ü–æ–¥—Ö–æ–¥</strong>: —É—Å–ª–æ–≤–Ω—ã–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞</li>
      <li><strong>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ</strong>: —É—á–∏—Ç—ã–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–µ—Ç–∫–∞–º–∏</li>
      <li><strong>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ</strong>: NLP, –±–∏–æ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞, CV</li>
    </ul>
    <blockquote>CRF –º–æ–¥–µ–ª–∏—Ä—É—é—Ç P(Y|X) –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π, —É—á–∏—Ç—ã–≤–∞—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç</blockquote>
  </div>

  <div class="block">
    <h2>üî∑ 2. –§–æ—Ä–º—É–ª–∞</h2>
    <pre><code>P(y|x) = (1/Z(x)) exp(Œ£·µ¢ Œ£‚Çñ Œª‚Çñf‚Çñ(y·µ¢‚Çã‚ÇÅ, y·µ¢, x, i))

–≥–¥–µ:
- y - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–µ—Ç–æ–∫
- x - –≤—Ö–æ–¥–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- f‚Çñ - –ø—Ä–∏–∑–Ω–∞–∫–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- Œª‚Çñ - –≤–µ—Å–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- Z(x) - –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—â–∞—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞</code></pre>
    <p><strong>–ò–Ω—Ç—É–∏—Ü–∏—è:</strong></p>
    <ul>
      <li>–í—ã—á–∏—Å–ª—è–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—Å–µ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–µ—Ç–æ–∫</li>
      <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –º–µ—Ç–∫–∞–º–∏</li>
      <li>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏–∑ –≤—Å–µ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</li>
    </ul>
  </div>

  <div class="block">
    <h2>üî∑ 3. Sklearn-crfsuite</h2>
    <pre><code>import sklearn_crfsuite
from sklearn_crfsuite import metrics

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è —Å–ª–æ–≤–∞
def word2features(sent, i):
    word = sent[i][0]
    postag = sent[i][1]
    
    features = {
        'bias': 1.0,
        'word.lower()': word.lower(),
        'word[-3:]': word[-3:],
        'word[-2:]': word[-2:],
        'word.isupper()': word.isupper(),
        'word.istitle()': word.istitle(),
        'word.isdigit()': word.isdigit(),
        'postag': postag,
    }
    
    if i > 0:
        word1 = sent[i-1][0]
        postag1 = sent[i-1][1]
        features.update({
            '-1:word.lower()': word1.lower(),
            '-1:postag': postag1,
        })
    else:
        features['BOS'] = True
    
    if i < len(sent)-1:
        word1 = sent[i+1][0]
        postag1 = sent[i+1][1]
        features.update({
            '+1:word.lower()': word1.lower(),
            '+1:postag': postag1,
        })
    else:
        features['EOS'] = True
    
    return features

# –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
crf = sklearn_crfsuite.CRF(
    algorithm='lbfgs',
    c1=0.1,
    c2=0.1,
    max_iterations=100,
    all_possible_transitions=True
)

# –û–±—É—á–µ–Ω–∏–µ
crf.fit(X_train, y_train)

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
y_pred = crf.predict(X_test)</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 4. –ü—Ä–∏–∑–Ω–∞–∫–∏</h2>
    <p><strong>–¢–∏–ø—ã –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:</strong></p>
    <ul>
      <li><strong>–°–ª–æ–≤–æ</strong>: lowercase, —Å—É—Ñ—Ñ–∏–∫—Å—ã, –ø—Ä–µ—Ñ–∏–∫—Å—ã</li>
      <li><strong>–§–æ—Ä–º–∞</strong>: —Ä–µ–≥–∏—Å—Ç—Ä, —Ü–∏—Ñ—Ä—ã, –ø—É–Ω–∫—Ç—É–∞—Ü–∏—è</li>
      <li><strong>–ö–æ–Ω—Ç–µ–∫—Å—Ç</strong>: –æ–∫—Ä—É–∂–∞—é—â–∏–µ —Å–ª–æ–≤–∞ (–æ–∫–Ω–æ ¬±2)</li>
      <li><strong>POS —Ç–µ–≥–∏</strong>: —á–∞—Å—Ç–∏ —Ä–µ—á–∏</li>
      <li><strong>–°–ª–æ–≤–∞—Ä–∏</strong>: gazetteer –ø—Ä–∏–∑–Ω–∞–∫–∏</li>
      <li><strong>–ö–∞—Å—Ç–æ–º–Ω—ã–µ</strong>: domain-specific</li>
    </ul>
    
    <pre><code># –ü—Ä–∏–º–µ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
features = {
    'word.lower': 'john',
    'word.isupper': False,
    'word.istitle': True,
    'word[-3:]': 'ohn',
    'postag': 'NNP',
    '-1:word.lower': 'mr',
    '+1:word.lower': 'smith'
}</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 5. NER –ø—Ä–∏–º–µ—Ä</h2>
    <pre><code># –î–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ IOB
sent = [
    ('John', 'NNP', 'B-PER'),
    ('Smith', 'NNP', 'I-PER'),
    ('works', 'VBZ', 'O'),
    ('at', 'IN', 'O'),
    ('Google', 'NNP', 'B-ORG')
]

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
X = [[word2features(sent, i) for i in range(len(sent))]]

# –ú–µ—Ç–∫–∏
y = [[label for _, _, label in sent]]

# –û–±—É—á–µ–Ω–∏–µ
crf.fit(X, y)

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
new_sent = [('Apple', 'NNP'), ('released', 'VBD'), ('iPhone', 'NNP')]
X_new = [[word2features(new_sent, i) for i in range(len(new_sent))]]
predictions = crf.predict(X_new)
print(predictions)  # [['B-ORG', 'O', 'B-PRODUCT']]</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 6. –û—Ü–µ–Ω–∫–∞</h2>
    <pre><code>from sklearn_crfsuite import metrics

# –ú–µ—Ç—Ä–∏–∫–∏
labels = list(crf.classes_)
labels.remove('O')  # –ò—Å–∫–ª—é—á–∞–µ–º –∫–ª–∞—Å—Å 'O'

# F1-score
f1 = metrics.flat_f1_score(y_test, y_pred, 
                           average='weighted', labels=labels)
print(f'F1: {f1:.3f}')

# Precision –∏ Recall –ø–æ –∫–ª–∞—Å—Å–∞–º
print(metrics.flat_classification_report(
    y_test, y_pred, labels=labels))

# –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
#               precision    recall  f1-score   support
# 
#        B-LOC       0.81      0.78      0.79      1084
#        I-LOC       0.76      0.73      0.74       325
#       B-MISC       0.73      0.49      0.59       339
#       I-MISC       0.70      0.53      0.60       557
#        B-ORG       0.79      0.82      0.80      1400
#        I-ORG       0.83      0.83      0.83      1104
#        B-PER       0.84      0.90      0.87       735
#        I-PER       0.90      0.93      0.92       634</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 7. CRF vs HMM</h2>
    <table>
      <tr>
        <th>–ê—Å–ø–µ–∫—Ç</th>
        <th>CRF</th>
        <th>HMM</th>
      </tr>
      <tr>
        <td>–¢–∏–ø –º–æ–¥–µ–ª–∏</td>
        <td>–î–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ç–∏–≤–Ω–∞—è</td>
        <td>–ì–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω–∞—è</td>
      </tr>
      <tr>
        <td>–ú–æ–¥–µ–ª–∏—Ä—É–µ—Ç</td>
        <td>P(Y|X)</td>
        <td>P(X,Y)</td>
      </tr>
      <tr>
        <td>–ü—Ä–∏–∑–Ω–∞–∫–∏</td>
        <td>–õ—é–±—ã–µ, –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è</td>
        <td>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ, –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ</td>
      </tr>
      <tr>
        <td>–¢–æ—á–Ω–æ—Å—Ç—å</td>
        <td>–í—ã—à–µ</td>
        <td>–ù–∏–∂–µ</td>
      </tr>
      <tr>
        <td>–°–∫–æ—Ä–æ—Å—Ç—å</td>
        <td>–ú–µ–¥–ª–µ–Ω–Ω–µ–µ</td>
        <td>–ë—ã—Å—Ç—Ä–µ–µ</td>
      </tr>
      <tr>
        <td>Label bias</td>
        <td>–ù–µ—Ç</td>
        <td>–ï—Å—Ç—å</td>
      </tr>
    </table>
  </div>

  <div class="block">
    <h2>üî∑ 8. –ì–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
    <ul>
      <li><code>c1</code>: L1 —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è (0.0-1.0)
        <ul><li>–ë–æ–ª—å—à–µ ‚Üí sparser weights</li></ul>
      </li>
      <li><code>c2</code>: L2 —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è (0.0-1.0)
        <ul><li>–ë–æ–ª—å—à–µ ‚Üí smoother weights</li></ul>
      </li>
      <li><code>algorithm</code>: 'lbfgs' (–æ—Å–Ω–æ–≤–Ω–æ–π), 'l2sgd', 'ap'</li>
      <li><code>max_iterations</code>: 100-500</li>
      <li><code>all_possible_transitions</code>: True (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</li>
    </ul>
    
    <pre><code># Grid search –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
from sklearn.model_selection import RandomizedSearchCV

params_space = {
    'c1': [0.01, 0.05, 0.1, 0.5, 1.0],
    'c2': [0.01, 0.05, 0.1, 0.5, 1.0],
}

rs = RandomizedSearchCV(crf, params_space, cv=3, n_iter=20)
rs.fit(X_train, y_train)
print(f'Best params: {rs.best_params_}')</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 9. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏—è</h2>
    <ul>
      <li><strong>Named Entity Recognition (NER)</strong>
        <ul><li>–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π, –ª–æ–∫–∞—Ü–∏–π</li></ul>
      </li>
      <li><strong>Part-of-Speech (POS) Tagging</strong>
        <ul><li>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∞—Å—Ç–µ–π —Ä–µ—á–∏</li></ul>
      </li>
      <li><strong>Chunking</strong>
        <ul><li>–í—ã–¥–µ–ª–µ–Ω–∏–µ —Ñ—Ä–∞–∑ –≤ —Ç–µ–∫—Å—Ç–µ</li></ul>
      </li>
      <li><strong>Gene Finding</strong>
        <ul><li>–ë–∏–æ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞: –ø–æ–∏—Å–∫ –≥–µ–Ω–æ–≤ –≤ –î–ù–ö</li></ul>
      </li>
      <li><strong>OCR Post-processing</strong>
        <ul><li>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è</li></ul>
      </li>
      <li><strong>Information Extraction</strong>
        <ul><li>–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</li></ul>
      </li>
    </ul>
  </div>

  <div class="block">
    <h2>üî∑ 10. –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏</h2>
    <ul>
      <li><strong>–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –æ–∫–Ω–æ</strong>: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ¬±2 —Å–ª–æ–≤–∞</li>
      <li><strong>POS —Ç–µ–≥–∏</strong>: –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∫–∞–∫ –ø—Ä–∏–∑–Ω–∞–∫–∏</li>
      <li><strong>–°–ª–æ–≤–∞—Ä–∏</strong>: gazetteer lists –¥–ª—è domain</li>
      <li><strong>–†–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è</strong>: –Ω–∞—á–Ω–∏—Ç–µ —Å c1=c2=0.1</li>
      <li><strong>Cross-validation</strong>: –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</li>
      <li><strong>IOB —Ñ–æ—Ä–º–∞—Ç</strong>: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è multi-token entities</li>
      <li><strong>–ë–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤</strong>: —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –¥–∏—Å–±–∞–ª–∞–Ω—Å</li>
    </ul>
  </div>

</div>
</body>
</html>
