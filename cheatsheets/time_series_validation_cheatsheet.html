<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ Cheatsheet ‚Äî 3 –∫–æ–ª–æ–Ω–∫–∏</title>
  <style>
    @media screen {
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
        color: #333;
        background: #fafcff;
        padding: 10px;
      }
    }
    @media print {
      body {
        background: white;
        padding: 0;
      }
      @page {
        size: A4 landscape;
        margin: 10mm;
      }
    }

    .container {
      column-count: 3;
      column-gap: 20px;
      max-width: 100%;
    }

    .block {
      break-inside: avoid;
      margin-bottom: 1.2em;
      padding: 12px;
      background: white;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    h1 {
      font-size: 1.6em;
      font-weight: 700;
      color: #1a5fb4;
      text-align: center;
      margin: 0 0 8px;
      column-span: all;
    }

    .subtitle {
      text-align: center;
      color: #666;
      font-size: 0.9em;
      margin-bottom: 12px;
      column-span: all;
    }

    h2 {
      font-size: 1.15em;
      font-weight: 700;
      color: #1a5fb4;
      margin: 0 0 8px;
      padding-bottom: 4px;
      border-bottom: 1px solid #e0e7ff;
    }

    p, ul, ol {
      font-size: 0.92em;
      margin: 0.6em 0;
    }

    ul, ol {
      padding-left: 18px;
    }

    li {
      margin-bottom: 4px;
    }

    code {
      font-family: 'Consolas', 'Courier New', monospace;
      background-color: #f0f4ff;
      padding: 1px 4px;
      border-radius: 3px;
      font-size: 0.88em;
    }

    pre {
      background-color: #f0f4ff;
      padding: 8px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 0.84em;
      margin: 6px 0;
    }

    pre code {
      padding: 0;
      background: none;
      white-space: pre-wrap;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82em;
      margin: 6px 0;
    }

    th {
      background-color: #e6f0ff;
      text-align: left;
      padding: 4px 6px;
      font-weight: 600;
    }

    td {
      padding: 4px 6px;
      border-bottom: 1px solid #f0f4ff;
    }

    tr:nth-child(even) {
      background-color: #f8fbff;
    }

    .good-vs-bad {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .good-vs-bad div {
      flex: 1;
      padding: 6px 8px;
      border-radius: 4px;
    }

    .good {
      background-color: #f0f9f4;
      border-left: 3px solid #2e8b57;
    }

    .bad {
      background-color: #fdf0f2;
      border-left: 3px solid #d32f2f;
    }

    .good h3, .bad h3 {
      margin: 0 0 4px;
      font-size: 1em;
      font-weight: 700;
    }

    .good ul, .bad ul {
      padding-left: 20px;
      margin: 0;
    }

    .good li::before { content: "‚úÖ "; font-weight: bold; }
    .bad li::before { content: "‚ùå "; font-weight: bold; }

    blockquote {
      font-style: italic;
      margin: 8px 0;
      padding: 6px 10px;
      background: #f8fbff;
      border-left: 2px solid #1a5fb4;
      font-size: 0.88em;
    }

    @media print {
      .container { column-gap: 12px; }
      .block { box-shadow: none; }
      code, pre, table { font-size: 0.78em; }
      h1 { font-size: 1.4em; }
      h2 { font-size: 1em; }
    }
  </style>
</head>
<body>

<div class="container">

  <h1>‚è∞ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤</h1>
  <div class="subtitle">üìÖ –Ø–Ω–≤–∞—Ä—å 2026</div>

  <div class="block">
    <h2>üî∑ 1. –ü–æ—á–µ–º—É –æ–±—ã—á–Ω–∞—è CV –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç?</h2>
    <ul>
      <li><strong>–í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å</strong>: –ø–æ—Ä—è–¥–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤–∞–∂–µ–Ω</li>
      <li><strong>–£—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö</strong>: –Ω–µ–ª—å–∑—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –±—É–¥—É—â–µ–º</li>
      <li><strong>–°–µ–∑–æ–Ω–Ω–æ—Å—Ç—å</strong>: –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥—ã</li>
      <li><strong>–î—Ä–µ–π—Ñ</strong>: –¥–∞–Ω–Ω—ã–µ –º–µ–Ω—è—é—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º</li>
    </ul>
    <p><strong>‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</strong> KFold, StratifiedKFold, ShuffleSplit</p>

  <div class="block">
    <h2>üî∑ 2. Time Series Split</h2>
    <pre><code>from sklearn.model_selection import TimeSeriesSplit
import numpy as np

# –î–∞–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞
X = np.array([[1], [2], [3], [4], [5], [6], [7], [8]])
y = np.array([10, 20, 30, 40, 50, 60, 70, 80])

# TimeSeriesSplit
tscv = TimeSeriesSplit(n_splits=3)

for fold, (train_idx, val_idx) in enumerate(tscv.split(X)):
    print(f"Fold {fold+1}:")
    print(f"  Train: {train_idx}")
    print(f"  Val:   {val_idx}")

# Output:
# Fold 1:
#   Train: [0 1 2]
#   Val:   [3 4]
# Fold 2:
#   Train: [0 1 2 3 4]
#   Val:   [5 6]
# Fold 3:
#   Train: [0 1 2 3 4 5 6]
#   Val:   [7]</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 3. Walk-Forward Validation</h2>
    <pre><code># –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫–Ω–æ –æ–±—É—á–µ–Ω–∏—è
def walk_forward_validation(data, n_train, n_test):
    scores = []
    
    for i in range(len(data) - n_train - n_test + 1):
        # –û–∫–Ω–∞ train –∏ test
        train = data[i:i+n_train]
        test = data[i+n_train:i+n_train+n_test]
        
        # –û–±—É—á–µ–Ω–∏–µ –∏ –æ—Ü–µ–Ω–∫–∞
        model.fit(train[0], train[1])
        score = model.score(test[0], test[1])
        scores.append(score)
        
        print(f"Window {i+1}: Train [{i}:{i+n_train}], "
              f"Test [{i+n_train}:{i+n_train+n_test}]")
    
    return scores

# –ü—Ä–∏–º–µ—Ä
scores = walk_forward_validation(data, n_train=100, n_test=20)</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 4. Expanding Window</h2>
    <pre><code># –†–∞—Å—Ç—É—â–µ–µ –æ–∫–Ω–æ –æ–±—É—á–µ–Ω–∏—è
def expanding_window_validation(data, min_train, n_test):
    scores = []
    
    for i in range(min_train, len(data) - n_test + 1):
        # Train: –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ i
        # Test: —Å–ª–µ–¥—É—é—â–∏–µ n_test —Ç–æ—á–µ–∫
        train = data[:i]
        test = data[i:i+n_test]
        
        model.fit(train[0], train[1])
        score = model.score(test[0], test[1])
        scores.append(score)
        
        print(f"Train size: {len(train)}, Test: [{i}:{i+n_test}]")
    
    return scores

scores = expanding_window_validation(data, min_train=50, n_test=10)</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 5. Blocked Cross-Validation</h2>
    <pre><code># –ë–ª–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å gap
class BlockedTimeSeriesSplit:
    def __init__(self, n_splits=3, test_size=30, gap=7):
        self.n_splits = n_splits
        self.test_size = test_size
        self.gap = gap
    
    def split(self, X):
        n_samples = len(X)
        indices = np.arange(n_samples)
        
        for i in range(self.n_splits):
            # Test –∏–Ω–¥–µ–∫—Å—ã
            test_start = n_samples - (self.n_splits - i) * self.test_size
            test_end = test_start + self.test_size
            
            # Train –∏–Ω–¥–µ–∫—Å—ã (—Å gap)
            train_end = test_start - self.gap
            
            if train_end > 0:
                train_idx = indices[:train_end]
                test_idx = indices[test_start:test_end]
                yield train_idx, test_idx

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
bts = BlockedTimeSeriesSplit(n_splits=3, test_size=30, gap=7)
for fold, (train_idx, test_idx) in enumerate(bts.split(X)):
    print(f"Fold {fold+1}: Train {len(train_idx)}, Test {len(test_idx)}")</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 6. –°–µ–∑–æ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è</h2>
    <pre><code>import pandas as pd

# –î–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç–∞–º–∏
df = pd.DataFrame({
    'date': pd.date_range('2020-01-01', periods=365*3, freq='D'),
    'value': np.random.randn(365*3)
})

# –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ –≥–æ–¥–∞–º
def seasonal_validation(df, date_col, target_col):
    df['year'] = df[date_col].dt.year
    years = sorted(df['year'].unique())
    
    scores = []
    for test_year in years[1:]:  # –ü–µ—Ä–≤—ã–π –≥–æ–¥ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
        train = df[df['year'] < test_year]
        test = df[df['year'] == test_year]
        
        # –û–±—É—á–µ–Ω–∏–µ –∏ –æ—Ü–µ–Ω–∫–∞
        model.fit(train.drop([date_col, target_col, 'year'], axis=1),
                 train[target_col])
        score = model.score(test.drop([date_col, target_col, 'year'], axis=1),
                          test[target_col])
        scores.append(score)
        print(f"Train: years < {test_year}, Test: {test_year}")
    
    return scores</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 7. –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤ –≤–ø–µ—Ä–µ–¥</h2>
    <pre><code># Multi-step forecast validation
def multi_step_validation(data, model, n_train, horizon):
    predictions = []
    actuals = []
    
    for i in range(n_train, len(data) - horizon):
        # Train –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
        train_data = data[:i]
        model.fit(train_data[:-1], train_data[1:])
        
        # –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ horizon —à–∞–≥–æ–≤
        for h in range(1, horizon + 1):
            pred = model.predict([data[i-1:i]])
            predictions.append(pred)
            actuals.append(data[i+h-1])
    
    return predictions, actuals

# One-step vs multi-step
# One-step: –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–ª–µ–¥—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
# Multi-step: –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º H —Å–ª–µ–¥—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 8. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤</h2>
    <table>
      <tr><th>–ú–µ—Ç–æ–¥</th><th>–û–∫–Ω–æ train</th><th>–ü–ª—é—Å—ã</th><th>–ú–∏–Ω—É—Å—ã</th></tr>
      <tr>
        <td><strong>TimeSeriesSplit</strong></td>
        <td>–†–∞—Å—Ç—É—â–µ–µ</td>
        <td>–ü—Ä–æ—Å—Ç–æ–π, –≤—Å—Ç—Ä–æ–µ–Ω –≤ sklearn</td>
        <td>–ù–µ—Ç gap, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π test</td>
      </tr>
      <tr>
        <td><strong>Walk-Forward</strong></td>
        <td>–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ</td>
        <td>–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä train</td>
        <td>–¢–µ—Ä—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ</td>
      </tr>
      <tr>
        <td><strong>Expanding Window</strong></td>
        <td>–†–∞—Å—Ç—É—â–µ–µ</td>
        <td>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</td>
        <td>–ú–µ–¥–ª–µ–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ</td>
      </tr>
      <tr>
        <td><strong>Blocked</strong></td>
        <td>–° gap</td>
        <td>–£—á–∏—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏</td>
        <td>–ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è train</td>
      </tr>
    </table>
  </div>

  <div class="block">
    <h2>üî∑ 9. –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏</h2>
    <div class="good-vs-bad">
      <div class="good">
        <h3>‚úÖ –î–µ–ª–∞—Ç—å</h3>
        <ul>
          <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤</li>
          <li>–î–æ–±–∞–≤–ª—è—Ç—å gap –º–µ–∂–¥—É train –∏ test</li>
          <li>–£—á–∏—Ç—ã–≤–∞—Ç—å —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å</li>
          <li>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö</li>
          <li>–ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω–æ—Å—Ç—å</li>
        </ul>
      </div>
      <div class="bad">
        <h3>‚ùå –ù–µ –¥–µ–ª–∞—Ç—å</h3>
        <ul>
          <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å random shuffle</li>
          <li>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –±—É–¥—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö</li>
          <li>–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É</li>
          <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—ã–π KFold</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="block">
    <h2>üî∑ 10. –ß–µ–∫-–ª–∏—Å—Ç</h2>
    <ul>
      <li>[ ] –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ</li>
      <li>[ ] –í—ã–±—Ä–∞—Ç—å –º–µ—Ç–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (TimeSeriesSplit, Walk-Forward, Expanding)</li>
      <li>[ ] –î–æ–±–∞–≤–∏—Ç—å gap –µ—Å–ª–∏ –Ω—É–∂–Ω–æ</li>
      <li>[ ] –£—á–µ—Å—Ç—å —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å</li>
      <li>[ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö</li>
      <li>[ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥</li>
    </ul>

    <h3>üí° –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑—á–∏–∫—É:</h3>
    <blockquote>
      ¬´–î–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –≤–∞–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –¥–∞–Ω–Ω—ã—Ö. –ú—ã —Ç—Ä–µ–Ω–∏—Ä—É–µ–º—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–æ—à–ª–æ–º –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ –±—É–¥—É—â–µ–º, –∫–∞–∫ –±—É–¥–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏ ‚Äî –Ω–µ–ª—å–∑—è –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞–≤—Ç—Ä–∞—à–Ω–∏–π –∫—É—Ä—Å –∞–∫—Ü–∏–π, –∑–Ω–∞—è –ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞—à–Ω–∏–π¬ª.
    </blockquote>
  </div>

</div>

</div>
</body>
</html>