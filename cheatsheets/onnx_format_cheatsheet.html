<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>ONNX Format Cheatsheet ‚Äî 3 –∫–æ–ª–æ–Ω–∫–∏</title>
  <style>
    @media screen {
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
        color: #333;
        background: #fafcff;
        padding: 10px;
      }
    }
    @media print {
      body {
        background: white;
        padding: 0;
      }
      @page {
        size: A4 landscape;
        margin: 10mm;
      }
    }

    .container {
      column-count: 3;
      column-gap: 20px;
      max-width: 100%;
    }

    .block {
      break-inside: avoid;
      margin-bottom: 1.2em;
      padding: 12px;
      background: white;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    h1 {
      font-size: 1.6em;
      font-weight: 700;
      color: #1a5fb4;
      text-align: center;
      margin: 0 0 8px;
      column-span: all;
    }

    .subtitle {
      text-align: center;
      color: #666;
      font-size: 0.9em;
      margin-bottom: 12px;
      column-span: all;
    }

    h2 {
      font-size: 1.15em;
      font-weight: 700;
      color: #1a5fb4;
      margin: 0 0 8px;
      padding-bottom: 4px;
      border-bottom: 1px solid #e0e7ff;
    }

    p, ul, ol {
      font-size: 0.92em;
      margin: 0.6em 0;
    }

    ul, ol {
      padding-left: 18px;
    }

    li {
      margin-bottom: 4px;
    }

    code {
      font-family: 'Consolas', 'Courier New', monospace;
      background-color: #f0f4ff;
      padding: 1px 4px;
      border-radius: 3px;
      font-size: 0.88em;
    }

    pre {
      background-color: #f0f4ff;
      padding: 8px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 0.84em;
      margin: 6px 0;
    }

    pre code {
      padding: 0;
      background: none;
      white-space: pre-wrap;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82em;
      margin: 6px 0;
    }

    th {
      background-color: #e6f0ff;
      text-align: left;
      padding: 4px 6px;
      font-weight: 600;
    }

    td {
      padding: 4px 6px;
      border-bottom: 1px solid #f0f4ff;
    }

    tr:nth-child(even) {
      background-color: #f8fbff;
    }

    .good-vs-bad {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .good-vs-bad div {
      flex: 1;
      padding: 6px 8px;
      border-radius: 4px;
    }

    .good {
      background-color: #f0f9f4;
      border-left: 3px solid #2e8b57;
    }

    .bad {
      background-color: #fdf0f2;
      border-left: 3px solid #d32f2f;
    }

    .good h3, .bad h3 {
      margin: 0 0 4px;
      font-size: 1em;
      font-weight: 700;
    }

    .good ul, .bad ul {
      padding-left: 20px;
      margin: 0;
    }

    .good li::before { content: "‚úÖ "; font-weight: bold; }
    .bad li::before { content: "‚ùå "; font-weight: bold; }

    blockquote {
      font-style: italic;
      margin: 8px 0;
      padding: 6px 10px;
      background: #f8fbff;
      border-left: 2px solid #1a5fb4;
      font-size: 0.88em;
    }

    @media print {
      .container { column-gap: 12px; }
      .block { box-shadow: none; }
      code, pre, table { font-size: 0.78em; }
      h1 { font-size: 1.4em; }
      h2 { font-size: 1em; }
    }
  </style>
</head>
<body>

<div class="container">

  <h1>üîÑ ONNX Format</h1>
  <div class="subtitle">üìÖ –Ø–Ω–≤–∞—Ä—å 2026</div>

  <div class="block">
    <h2>üî∑ 1. –ß—Ç–æ —Ç–∞–∫–æ–µ ONNX</h2>
    <ul>
      <li><strong>ONNX</strong>: Open Neural Network Exchange</li>
      <li><strong>–¶–µ–ª—å</strong>: —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è DL –º–æ–¥–µ–ª–µ–π</li>
      <li><strong>–°–æ–∑–¥–∞—Ç–µ–ª–∏</strong>: Microsoft, Facebook (Meta)</li>
      <li><strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</strong>: –ø–µ—Ä–µ–Ω–æ—Å –º–æ–¥–µ–ª–µ–π –º–µ–∂–¥—É —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏</li>
      <li><strong>–§–æ—Ä–º–∞—Ç</strong>: Protocol Buffers (protobuf)</li>
    </ul>
    <blockquote>
      ONNX –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—É—á–∞—Ç—å –º–æ–¥–µ–ª—å –≤ PyTorch –∏ –¥–µ–ø–ª–æ–∏—Ç—å –≤ TensorFlow –∏–ª–∏ –¥—Ä—É–≥–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ.
    </blockquote>

  <div class="block">
    <h2>üî∑ 2. –ó–∞—á–µ–º –Ω—É–∂–µ–Ω ONNX</h2>
    <table>
      <tr><th>–ü—Ä–æ–±–ª–µ–º–∞</th><th>–†–µ—à–µ–Ω–∏–µ ONNX</th></tr>
      <tr><td>Framework lock-in</td><td>–ü–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å –º–æ–¥–µ–ª–µ–π</td></tr>
      <tr><td>–†–∞–∑–Ω—ã–µ production —Å–∏—Å—Ç–µ–º—ã</td><td>–ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç</td></tr>
      <tr><td>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è deployment</td><td>ONNX Runtime</td></tr>
      <tr><td>Hardware acceleration</td><td>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ GPU, NPU, TPU</td></tr>
      <tr><td>Cross-platform</td><td>Windows, Linux, mobile, web</td></tr>
    </table>
  </div>

  <div class="block">
    <h2>üî∑ 3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏</h2>
    <p><strong>Export –≤ ONNX</strong>:</p>
    <ul>
      <li>PyTorch</li>
      <li>TensorFlow / Keras</li>
      <li>Scikit-learn</li>
      <li>XGBoost, LightGBM</li>
      <li>MXNet</li>
      <li>Caffe2</li>
      <li>CNTK</li>
    </ul>

    <p><strong>Import –∏–∑ ONNX</strong>:</p>
    <ul>
      <li>ONNX Runtime</li>
      <li>TensorFlow</li>
      <li>PyTorch</li>
      <li>Caffe2</li>
      <li>CoreML (Apple)</li>
      <li>TensorRT (NVIDIA)</li>
    </ul>
  </div>

  <div class="block">
    <h2>üî∑ 4. –≠–∫—Å–ø–æ—Ä—Ç –∏–∑ PyTorch</h2>
    <pre><code>import torch
import torch.onnx

# –ú–æ–¥–µ–ª—å PyTorch
model = MyModel()
model.eval()

# Dummy input –¥–ª—è tracing
dummy_input = torch.randn(1, 3, 224, 224)

# –≠–∫—Å–ø–æ—Ä—Ç
torch.onnx.export(
    model,
    dummy_input,
    "model.onnx",
    export_params=True,
    opset_version=14,
    do_constant_folding=True,
    input_names=['input'],
    output_names=['output'],
    dynamic_axes={
        'input': {0: 'batch_size'},
        'output': {0: 'batch_size'}
    }
)</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 5. –≠–∫—Å–ø–æ—Ä—Ç –∏–∑ TensorFlow</h2>
    <pre><code>import tensorflow as tf
import tf2onnx

# –ú–æ–¥–µ–ª—å TensorFlow
model = tf.keras.models.load_model('model.h5')

# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
spec = (tf.TensorSpec((None, 224, 224, 3), tf.float32, name="input"),)
output_path = "model.onnx"

model_proto, _ = tf2onnx.convert.from_keras(
    model,
    input_signature=spec,
    opset=14,
    output_path=output_path
)

print(f"ONNX model saved to {output_path}")</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 6. –≠–∫—Å–ø–æ—Ä—Ç Scikit-learn</h2>
    <pre><code>from skl2onnx import convert_sklearn
from skl2onnx.common.data_types import FloatTensorType

# Scikit-learn –º–æ–¥–µ–ª—å
model = RandomForestClassifier()
model.fit(X_train, y_train)

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≤—Ö–æ–¥–∞
initial_type = [
    ('float_input', FloatTensorType([None, X_train.shape[1]]))
]

# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
onx = convert_sklearn(
    model,
    initial_types=initial_type,
    target_opset=14
)

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
with open("model.onnx", "wb") as f:
    f.write(onx.SerializeToString())</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 7. ONNX Runtime</h2>
    <p><strong>Inference —Å ONNX Runtime</strong>:</p>
    <pre><code>import onnxruntime as ort
import numpy as np

# –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏
session = ort.InferenceSession("model.onnx")

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º—ë–Ω –≤—Ö–æ–¥–æ–≤/–≤—ã—Ö–æ–¥–æ–≤
input_name = session.get_inputs()[0].name
output_name = session.get_outputs()[0].name

# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
input_data = np.random.randn(1, 3, 224, 224).astype(np.float32)

# Inference
result = session.run(
    [output_name],
    {input_name: input_data}
)

print(f"Output: {result[0]}")</code></pre>

    <p><strong>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ ONNX Runtime</strong>:</p>
    <ul>
      <li>–ë—ã—Å—Ç—Ä–µ–µ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞</li>
      <li>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞</li>
      <li>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ GPU, CPU</li>
      <li>–ú–∞–ª–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏</li>
    </ul>
  </div>

  <div class="block">
    <h2>üî∑ 8. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ ONNX –º–æ–¥–µ–ª–∏</h2>
    <p><strong>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ONNX</strong>:</p>
    <table>
      <tr><th>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>
      <tr><td>Graph</td><td>–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞—Ñ</td></tr>
      <tr><td>Nodes</td><td>–û–ø–µ—Ä–∞—Ü–∏–∏ (Conv, ReLU, etc.)</td></tr>
      <tr><td>Tensors</td><td>–ú–Ω–æ–≥–æ–º–µ—Ä–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã</td></tr>
      <tr><td>Initializers</td><td>–í–µ—Å–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</td></tr>
      <tr><td>Metadata</td><td>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏</td></tr>
    </table>

    <pre><code># –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
import onnx

model = onnx.load("model.onnx")
print(f"IR version: {model.ir_version}")
print(f"Opset: {model.opset_import[0].version}")

# –ì—Ä–∞—Ñ
graph = model.graph
print(f"Inputs: {[i.name for i in graph.input]}")
print(f"Outputs: {[o.name for o in graph.output]}")
print(f"Nodes: {len(graph.node)}")</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 9. –í–∞–ª–∏–¥–∞—Ü–∏—è ONNX –º–æ–¥–µ–ª–∏</h2>
    <pre><code>import onnx

# –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏
model = onnx.load("model.onnx")

# –í–∞–ª–∏–¥–∞—Ü–∏—è
try:
    onnx.checker.check_model(model)
    print("‚úì Model is valid")
except onnx.checker.ValidationError as e:
    print(f"‚úó Model is invalid: {e}")

# Shape inference
model = onnx.shape_inference.infer_shapes(model)
onnx.save(model, "model_with_shapes.onnx")</code></pre>

    <p><strong>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</strong>:</p>
    <pre><code># Netron - –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
pip install netron
netron model.onnx

# –ò–ª–∏ programmatic
import onnx.utils
onnx.utils.extract_model("model.onnx", "model.onnx", 
                         ["input_node"], ["output_node"])</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 10. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ONNX</h2>
    <p><strong>ONNX Optimizer</strong>:</p>
    <pre><code>from onnxoptimizer import optimize
import onnx

model = onnx.load("model.onnx")

# –°–ø–∏—Å–æ–∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
passes = [
    'eliminate_deadend',
    'eliminate_identity',
    'eliminate_nop_dropout',
    'eliminate_nop_pad',
    'eliminate_nop_transpose',
    'eliminate_unused_initializer',
    'fuse_add_bias_into_conv',
    'fuse_bn_into_conv',
    'fuse_consecutive_concats',
    'fuse_consecutive_reduce_unsqueeze',
    'fuse_consecutive_squeezes',
    'fuse_consecutive_transposes',
    'fuse_matmul_add_bias_into_gemm',
    'fuse_pad_into_conv',
    'fuse_transpose_into_gemm'
]

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
optimized_model = optimize(model, passes)
onnx.save(optimized_model, "model_optimized.onnx")</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 11. –ö–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è ONNX</h2>
    <pre><code>from onnxruntime.quantization import quantize_dynamic, QuantType

# Dynamic quantization
quantize_dynamic(
    "model.onnx",
    "model_quantized.onnx",
    weight_type=QuantType.QInt8
)

# Static quantization (—Ç—Ä–µ–±—É–µ—Ç –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
from onnxruntime.quantization import quantize_static, CalibrationDataReader

class DataReader(CalibrationDataReader):
    def __init__(self, calibration_data):
        self.data = calibration_data
        self.current = 0
    
    def get_next(self):
        if self.current >= len(self.data):
            return None
        data = {"input": self.data[self.current]}
        self.current += 1
        return data

quantize_static(
    "model.onnx",
    "model_static_quantized.onnx",
    DataReader(calibration_data)
)</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 12. ONNX –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö</h2>
    <p><strong>Mobile (iOS)</strong>:</p>
    <ul>
      <li>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ CoreML</li>
      <li>onnx-coreml –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä</li>
      <li>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Apple Neural Engine</li>
    </ul>

    <p><strong>Android</strong>:</p>
    <ul>
      <li>ONNX Runtime for Android</li>
      <li>TFLite —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é</li>
      <li>NNAPI acceleration</li>
    </ul>

    <p><strong>Web</strong>:</p>
    <ul>
      <li>ONNX.js –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤</li>
      <li>WebGL backend</li>
      <li>WebAssembly backend</li>
    </ul>

    <pre><code># ONNX.js –≤ –±—Ä–∞—É–∑–µ—Ä–µ
<script src="onnx.min.js"></script>
<script>
  const session = new onnx.InferenceSession();
  await session.loadModel("model.onnx");
  const outputMap = await session.run([inputTensor]);
</script></code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 13. Best Practices</h2>
    <div class="good-vs-bad">
      <div class="good">
        <h3>‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
        <ul>
          <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π opset</li>
          <li>–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å –ø–æ—Å–ª–µ —ç–∫—Å–ø–æ—Ä—Ç–∞</li>
          <li>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å outputs —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–º</li>
          <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å dynamic axes –¥–ª—è batch</li>
          <li>–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ deployment</li>
          <li>–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å input/output shapes</li>
        </ul>
      </div>
      
      <div class="bad">
        <h3>‚ùå –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã</h3>
        <ul>
          <li>Custom –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</li>
          <li>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ input shapes</li>
          <li>–£—Å—Ç–∞—Ä–µ–≤—à–∏–π opset</li>
          <li>–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ preprocessing</li>
          <li>–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ warnings</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="block">
    <h2>üî∑ 14. Troubleshooting</h2>
    <p><strong>–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ</strong>:</p>
    <table>
      <tr><th>–û—à–∏–±–∫–∞</th><th>–†–µ—à–µ–Ω–∏–µ</th></tr>
      <tr><td>Unsupported operator</td><td>–û–±–Ω–æ–≤–∏—Ç—å opset –∏–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å custom op</td></tr>
      <tr><td>Dynamic shapes –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç</td><td>–£–∫–∞–∑–∞—Ç—å dynamic_axes —è–≤–Ω–æ</td></tr>
      <tr><td>–ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞</td><td>–ö–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è, pruning</td></tr>
      <tr><td>Slow inference</td><td>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GPU</td></tr>
      <tr><td>–†–∞–∑–Ω—ã–µ outputs</td><td>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å preprocessing, dtype</td></tr>
    </table>

    <blockquote>
      –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å custom –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –º–æ–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π ONNX –æ–ø–µ—Ä–∞—Ç–æ—Ä.
    </blockquote>
  </div>

</div>

</div>
</body>
</html>