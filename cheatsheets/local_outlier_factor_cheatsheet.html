<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Local Outlier Factor (LOF) Cheatsheet ‚Äî 3 –∫–æ–ª–æ–Ω–∫–∏</title>
  <style>
    @media screen { body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; color: #333; background: #fafcff; padding: 10px; }}
        .container {
      max-width: 100%;
    }

    /* Responsive columns: 3 columns on wide screens, fewer on narrow */
    @media (min-width: 900px) {
      .container {
        column-count: 3;
        column-gap: 20px;
      }
    }
    
    @media (min-width: 600px) and (max-width: 899px) {
      .container {
        column-count: 2;
        column-gap: 20px;
      }
    }
    
    @media (max-width: 599px) {
      .container {
        column-count: 1;
      }
    }
    .block { break-inside: avoid; margin-bottom: 1.2em; padding: 12px; background: white; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    h1 { font-size: 1.6em; font-weight: 700; color: #1a5fb4; text-align: center; margin: 0 0 8px; column-span: all; }
    .subtitle { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 12px; column-span: all; }
    h2 { font-size: 1.15em; font-weight: 700; color: #1a5fb4; margin: 0 0 8px; padding-bottom: 4px; border-bottom: 1px solid #e0e7ff; }
    p, ul, ol { font-size: 0.92em; margin: 0.6em 0; }
    ul, ol { padding-left: 18px; }
    li { margin-bottom: 4px; }
    code { font-family: 'Consolas', 'Courier New', monospace; background-color: #f0f4ff; padding: 1px 4px; border-radius: 3px; font-size: 0.88em; }
    pre { background-color: #f0f4ff; padding: 8px; border-radius: 4px; overflow-x: auto; font-size: 0.84em; margin: 6px 0; }
    pre code { padding: 0; background: none; white-space: pre-wrap; }
    table { width: 100%; border-collapse: collapse; font-size: 0.82em; margin: 6px 0; }
    th { background-color: #e6f0ff; text-align: left; padding: 4px 6px; font-weight: 600; }
    td { padding: 4px 6px; border-bottom: 1px solid #f0f4ff; }
    tr:nth-child(even) { background-color: #f8fbff; }
  </style>
</head>
<body>
<div class="container">
  <h1>üéØ Local Outlier Factor (LOF)</h1>
  <div class="subtitle"></div>

  <div class="block">
    <h2>üî∑ –°—É—Ç—å</h2>
    <ul>
      <li><strong>–¶–µ–ª—å</strong>: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∞–Ω–æ–º–∞–ª–∏–π</li>
      <li><strong>–ü—Ä–∏–Ω—Ü–∏–ø</strong>: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ —Å —Å–æ—Å–µ–¥—è–º–∏</li>
      <li><strong>LOF > 1</strong>: —Ç–æ—á–∫–∞ –±–æ–ª–µ–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ = –∞–Ω–æ–º–∞–ª–∏—è</li>
      <li><strong>LOF ‚âà 1</strong>: –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å</li>
    </ul>

  <div class="block">
    <h2>üî∑ –ë–∞–∑–æ–≤—ã–π –∫–æ–¥</h2>
    <pre><code>from sklearn.neighbors import LocalOutlierFactor

# LOF –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –≤—ã–±—Ä–æ—Å–æ–≤ –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
lof = LocalOutlierFactor(
    n_neighbors=20,
    contamination=0.1  # –æ–∂–∏–¥–∞–µ–º–∞—è –¥–æ–ª—è –∞–Ω–æ–º–∞–ª–∏–π
)

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ (fit_predict –≤–º–µ—Å—Ç–µ!)
predictions = lof.fit_predict(X)
# +1 = –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ, -1 = –∞–Ω–æ–º–∞–ª–∏–∏

# LOF scores (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∞–∫—Ç–æ—ÄLOF)
lof_scores = lof.negative_outlier_factor_

# –ß–µ–º –º–µ–Ω—å—à–µ (–±–æ–ª–µ–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π), —Ç–µ–º –±–æ–ª–µ–µ –∞–Ω–æ–º–∞–ª—å–Ω—ã–π
anomalies = X[predictions == -1]
print(f"–ù–∞–π–¥–µ–Ω–æ –∞–Ω–æ–º–∞–ª–∏–π: {len(anomalies)}")</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ Novelty Detection Mode</h2>
    <p>–î–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª–∏–π –≤ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</p>
    <pre><code># –û–±—É—á–µ–Ω–∏–µ –Ω–∞ —á–∏—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö
lof_novelty = LocalOutlierFactor(
    n_neighbors=20,
    novelty=True  # –≤–∞–∂–Ω–æ!
)

lof_novelty.fit(X_train)  # —Ç–æ–ª—å–∫–æ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
predictions = lof_novelty.predict(X_test)
scores = lof_novelty.score_samples(X_test)

# –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π score = –∞–Ω–æ–º–∞–ª–∏—è
anomalies_idx = predictions == -1
print(f"–ù–æ–≤—ã—Ö –∞–Ω–æ–º–∞–ª–∏–π: {anomalies_idx.sum()}")</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
    <table>
      <tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</th></tr>
      <tr><td><code>n_neighbors</code></td><td>–ß–∏—Å–ª–æ —Å–æ—Å–µ–¥–µ–π</td><td>20-50</td></tr>
      <tr><td><code>contamination</code></td><td>–î–æ–ª—è –∞–Ω–æ–º–∞–ª–∏–π</td><td>0.05-0.1</td></tr>
      <tr><td><code>novelty</code></td><td>–†–µ–∂–∏–º novelty detection</td><td>True –¥–ª—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</td></tr>
      <tr><td><code>metric</code></td><td>–ú–µ—Ç—Ä–∏–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è</td><td>'euclidean'</td></tr>
    </table>
  </div>

  <div class="block">
    <h2>üî∑ –ü–æ–¥–±–æ—Ä n_neighbors</h2>
    <pre><code># –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
neighbors_range = [10, 20, 30, 50]

for n in neighbors_range:
    lof = LocalOutlierFactor(n_neighbors=n, contamination=0.1)
    preds = lof.fit_predict(X)
    
    n_anomalies = (preds == -1).sum()
    print(f"n_neighbors={n}: {n_anomalies} –∞–Ω–æ–º–∞–ª–∏–π")</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ –ê–Ω–∞–ª–∏–∑ LOF scores</h2>
    <pre><code># –ü–æ–ª—É—á–∏—Ç—å LOF –∑–Ω–∞—á–µ–Ω–∏—è
lof = LocalOutlierFactor(n_neighbors=20)
lof.fit_predict(X)
lof_scores = -lof.negative_outlier_factor_  # –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ

# –¢–æ–ø-10 –∞–Ω–æ–º–∞–ª–∏–π
most_anomalous = np.argsort(lof_scores)[-10:]

print("–¢–æ–ø-10 –∞–Ω–æ–º–∞–ª–∏–π:")
for i, idx in enumerate(most_anomalous[::-1]):
    print(f"{i+1}. Index {idx}, LOF: {lof_scores[idx]:.3f}")

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
import matplotlib.pyplot as plt
plt.hist(lof_scores, bins=50, edgecolor='black')
plt.axvline(x=1.0, color='red', linestyle='--', label='Threshold')
plt.xlabel('LOF Score')
plt.ylabel('–ß–∞—Å—Ç–æ—Ç–∞')
plt.legend()
plt.show()</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</h2>
    <pre><code># 2D –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
lof = LocalOutlierFactor(n_neighbors=20)
predictions = lof.fit_predict(X[:, :2])
scores = -lof.negative_outlier_factor_

plt.figure(figsize=(10, 6))
scatter = plt.scatter(
    X[:, 0], X[:, 1],
    c=scores,
    cmap='RdYlBu_r',
    s=50,
    edgecolors='black'
)
plt.colorbar(scatter, label='LOF Score')
plt.title('LOF Anomaly Detection')
plt.show()

# –ö—Ä–∞—Å–Ω—ã–µ —Ç–æ—á–∫–∏ = –≤—ã—Å–æ–∫–∏–π LOF = –∞–Ω–æ–º–∞–ª–∏–∏</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ LOF</h2>
    <ul>
      <li>–ù–∞—Ö–æ–¥–∏—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –∞–Ω–æ–º–∞–ª–∏–∏</li>
      <li>–†–∞–±–æ—Ç–∞–µ—Ç —Å –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏ —Ä–∞–∑–Ω–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏</li>
      <li>–ù–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</li>
      <li>–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è</li>
      <li>–•–æ—Ä–æ—à–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è</li>
    </ul>
  </div>

  <div class="block">
    <h2>üî∑ –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏</h2>
    <ul>
      <li>–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –≤—ã–±–æ—Ä—É n_neighbors</li>
      <li>–ú–µ–¥–ª–µ–Ω–Ω—ã–π –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö</li>
      <li>–ü—Ä–æ–±–ª–µ–º—ã —Å –≤—ã—Å–æ–∫–æ–π —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å—é</li>
      <li>–ù—É–∂–Ω–æ –∑–Ω–∞—Ç—å contamination</li>
    </ul>
  </div>

  <div class="block">
    <h2>üî∑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤</h2>
    <pre><code># Outlier Detection (novelty=False)
lof_outlier = LocalOutlierFactor(novelty=False)
outliers = lof_outlier.fit_predict(X_all)
# –ù–∞—Ö–æ–¥–∏—Ç –≤—ã–±—Ä–æ—Å—ã –í –°–ê–ú–ò–• –¥–∞–Ω–Ω—ã—Ö

# Novelty Detection (novelty=True)
lof_novelty = LocalOutlierFactor(novelty=True)
lof_novelty.fit(X_clean)  # —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ
novelties = lof_novelty.predict(X_new)
# –ù–∞—Ö–æ–¥–∏—Ç –Ω–æ–≤—ã–µ –∞–Ω–æ–º–∞–ª–∏–∏ –≤ –ù–û–í–´–• –¥–∞–Ω–Ω—ã—Ö</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏</h2>
    <ul>
      <li><strong>n_neighbors</strong>: –Ω–∞—á–Ω–∏—Ç–µ —Å 20, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ</li>
      <li><strong>–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ</strong>: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ StandardScaler</li>
      <li><strong>PCA</strong>: –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏</li>
      <li><strong>contamination</strong>: –æ—Ü–µ–Ω–∏—Ç–µ –∏–∑ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏</li>
      <li><strong>–í–∞–ª–∏–¥–∞—Ü–∏—è</strong>: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∞–Ω–æ–º–∞–ª–∏—è—Ö</li>
    </ul>
  </div>

</div>
</div>
</body>
</html>
