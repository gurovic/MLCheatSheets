<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ML Pipelines Cheatsheet ‚Äî 3 –∫–æ–ª–æ–Ω–∫–∏</title>
<style>@media screen{body{font-family:-apple-system,sans-serif;color:#333;background:#fafcff;padding:10px
        min-width: 900px;
      }}    .container {
      max-width: 100%;
    }

    /* Responsive columns: 3 columns on wide screens, fewer on narrow */
    @media (min-width: 900px) {
      .container {
        column-count: 3;
        column-gap: 20px;
      }
    }
    
    @media (min-width: 600px) and (max-width: 899px) {
      .container {
        column-count: 2;
        column-gap: 20px;
      }
    }
    
    @media (max-width: 599px) {
      .container {
        column-count: 1;
      }
    }.block{break-inside:avoid;margin-bottom:1.2em;padding:12px;background:white;border-radius:6px}h1{font-size:1.6em;color:#1a5fb4;text-align:center;column-span:all}.subtitle{text-align:center;color:#666;font-size:0.9em;margin-bottom:12px;column-span:all}h2{font-size:1.15em;color:#1a5fb4;margin:8px 0;border-bottom:1px solid #e0e7ff}code{background:#f0f4ff;padding:2px 4px}pre{background:#f0f4ff;padding:8px;border-radius:4px;overflow-x:auto;font-size:0.84em}</style></head><body>
<div class="container"><h1>üîß ML Pipelines</h1>
<div class="subtitle">üìÖ –Ø–Ω–≤–∞—Ä—å 2026</div>
<div class="block"><h2>1. –ë–∞–∑–æ–≤—ã–π Pipeline</h2><pre><code>from sklearn.pipeline import Pipeline
from sklearn.preprocessing import StandardScaler
from sklearn.ensemble import RandomForestClassifier

pipeline = Pipeline([
    ('scaler', StandardScaler()),
    ('classifier', RandomForestClassifier())
])

pipeline.fit(X_train, y_train)
predictions = pipeline.predict(X_test)</code></pre></div>
<div class="block"><h2>2. ColumnTransformer</h2><pre><code>from sklearn.compose import ColumnTransformer
from sklearn.preprocessing import OneHotEncoder

preprocessor = ColumnTransformer([
    ('num', StandardScaler(), ['age', 'income']),
    ('cat', OneHotEncoder(), ['city', 'category'])
])

pipeline = Pipeline([
    ('prep', preprocessor),
    ('model', RandomForestClassifier())
])</code></pre></div>
<div class="block"><h2>3. make_pipeline</h2><pre><code>from sklearn.pipeline import make_pipeline

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–º–µ–Ω–∞
pipeline = make_pipeline(
    StandardScaler(),
    PCA(n_components=2),
    LogisticRegression()
)

# –î–æ—Å—Ç—É–ø –∫ —à–∞–≥–∞–º
pipeline.steps
pipeline.named_steps['pca']</code></pre></div>
<div class="block"><h2>4. FeatureUnion</h2><pre><code>from sklearn.pipeline import FeatureUnion
from sklearn.decomposition import PCA
from sklearn.feature_selection import SelectKBest

combined = FeatureUnion([
    ('pca', PCA(n_components=2)),
    ('select', SelectKBest(k=3))
])

X_combined = combined.fit_transform(X, y)</code></pre></div>
<div class="block"><h2>5. –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä</h2><pre><code>from sklearn.base import BaseEstimator, TransformerMixin

class MyTransformer(BaseEstimator, TransformerMixin):
    def __init__(self, factor=1):
        self.factor = factor
    
    def fit(self, X, y=None):
        return self
    
    def transform(self, X):
        return X * self.factor

pipeline = Pipeline([
    ('custom', MyTransformer(factor=2)),
    ('scaler', StandardScaler())
])</code></pre></div>
<div class="block"><h2>6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Pipeline</h2><pre><code>import joblib

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
joblib.dump(pipeline, 'model_pipeline.pkl')

# –ó–∞–≥—Ä—É–∑–∫–∞
pipeline = joblib.load('model_pipeline.pkl')

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
predictions = pipeline.predict(new_data)</code></pre></div>
<div class="block"><h2>7. GridSearch —Å Pipeline</h2><pre><code>from sklearn.model_selection import GridSearchCV

param_grid = {
    'scaler__with_mean': [True, False],
    'classifier__n_estimators': [50, 100],
    'classifier__max_depth': [5, 10]
}

grid = GridSearchCV(pipeline, param_grid, cv=5)
grid.fit(X_train, y_train)

best_params = grid.best_params_
best_model = grid.best_estimator_</code></pre></div>
<div class="block"><h2>8. –£—Å–ª–æ–≤–Ω—ã–µ —à–∞–≥–∏</h2><pre><code>from sklearn.pipeline import Pipeline

def create_pipeline(use_pca=False):
    steps = [('scaler', StandardScaler())]
    
    if use_pca:
        steps.append(('pca', PCA(n_components=2)))
    
    steps.append(('model', LogisticRegression()))
    
    return Pipeline(steps)</code></pre></div>
<div class="block"><h2>9. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Pipeline</h2><ul><li>–ò–∑–±–µ–≥–∞–µ—Ç data leakage</li><li>–£–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥</li><li>–õ–µ–≥–∫–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å/–∑–∞–≥—Ä—É–∑–∏—Ç—å</li><li>Grid search –ø—Ä–æ—â–µ</li><li>–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å</li></ul></div>
<div class="block"><h2>10. –ß–µ–∫-–ª–∏—Å—Ç</h2><ul><li>[ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pipeline –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</li><li>[ ] –í–∫–ª—é—á–∏—Ç—å –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ –≤ Pipeline</li><li>[ ] –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤–º–µ—Å—Ç–µ —Å –º–æ–¥–µ–ª—å—é</li><li>[ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</li><li>[ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–≥–∏</li></ul></div>

<div class="block">
<h2>11. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ Pipeline</h2>
<pre><code>import joblib

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ trained pipeline
joblib.dump(pipeline, 'model_pipeline.pkl')

# –ó–∞–≥—Ä—É–∑–∫–∞
loaded_pipeline = joblib.load('model_pipeline.pkl')

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
predictions = loaded_pipeline.predict(new_data)

# –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
import datetime
timestamp = datetime.datetime.now().strftime('%Y%m%d_%H%M%S')
filename = f'pipeline_v{timestamp}.pkl'
joblib.dump(pipeline, filename)</code></pre>
</div>

<div class="block">
<h2>12. Debugging Pipeline</h2>
<pre><code># –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
from sklearn import set_config
set_config(display='diagram')
pipeline  # –í Jupyter –ø–æ–∫–∞–∂–µ—Ç –¥–∏–∞–≥—Ä–∞–º–º—É

# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
X_transformed = pipeline.named_steps['scaler'].transform(X_train)

# –î–æ—Å—Ç—É–ø –∫ trained –º–æ–¥–µ–ª—è–º
model = pipeline.named_steps['classifier']
print(f"Model params: {model.get_params()}")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
for name, transform in pipeline.steps[:-1]:
    X_train = transform.fit_transform(X_train, y_train)
    print(f"After {name}: shape = {X_train.shape}")</code></pre>
</div>

<div class="block">
<h2>13. Best Practices</h2>
<ul>
<li>–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Pipeline –¥–ª—è production</li>
<li>–ü—Ä–∏–º–µ–Ω—è–π—Ç–µ ColumnTransformer –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤</li>
<li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ make_pipeline –¥–ª—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è</li>
<li>–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤–µ—Å—å pipeline, –Ω–µ —Ç–æ–ª—å–∫–æ –º–æ–¥–µ–ª—å</li>
<li>–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ pipeline –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</li>
<li>–í–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–π—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏</li>
<li>–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫–∞–∂–¥—ã–π —à–∞–≥ pipeline</li>
</ul>
</div>

</div>
</body></html>