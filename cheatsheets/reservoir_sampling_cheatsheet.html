<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Reservoir Sampling Cheatsheet ‚Äî 3 –∫–æ–ª–æ–Ω–∫–∏</title>
  <style>
    @media screen { body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; color: #333; background: #fafcff; padding: 10px; } }
    @media print { body { background: white; padding: 0; } @page { size: A4 landscape; margin: 10mm; } }
    .container { column-count: 3; column-gap: 20px; max-width: 100%; }
    .block { break-inside: avoid; margin-bottom: 1.2em; padding: 12px; background: white; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    h1 { font-size: 1.6em; font-weight: 700; color: #1a5fb4; text-align: center; margin: 0 0 8px; column-span: all; }
    .subtitle { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 12px; column-span: all; }
    h2 { font-size: 1.15em; font-weight: 700; color: #1a5fb4; margin: 0 0 8px; padding-bottom: 4px; border-bottom: 1px solid #e0e7ff; }
    p, ul, ol { font-size: 0.92em; margin: 0.6em 0; }
    ul, ol { padding-left: 18px; }
    li { margin-bottom: 4px; }
    code { font-family: 'Consolas', 'Courier New', monospace; background-color: #f0f4ff; padding: 1px 4px; border-radius: 3px; font-size: 0.88em; }
    pre { background-color: #f0f4ff; padding: 8px; border-radius: 4px; overflow-x: auto; font-size: 0.84em; margin: 6px 0; }
    pre code { padding: 0; background: none; white-space: pre-wrap; }
    table { width: 100%; border-collapse: collapse; font-size: 0.82em; margin: 6px 0; }
    th { background-color: #e6f0ff; text-align: left; padding: 4px 6px; font-weight: 600; }
    td { padding: 4px 6px; border-bottom: 1px solid #f0f4ff; }
    tr:nth-child(even) { background-color: #f8fbff; }
    .good-vs-bad { display: flex; flex-direction: column; gap: 8px; }
    .good-vs-bad div { flex: 1; padding: 6px 8px; border-radius: 4px; }
    .good { background-color: #f0f9f4; border-left: 3px solid #2e8b57; }
    .bad { background-color: #fdf0f2; border-left: 3px solid #d32f2f; }
    .good h3, .bad h3 { margin: 0 0 4px; font-size: 1em; font-weight: 700; }
    .good ul, .bad ul { padding-left: 20px; margin: 0; }
    .good li::before { content: "‚úÖ "; font-weight: bold; }
    .bad li::before { content: "‚ùå "; font-weight: bold; }
    blockquote { font-style: italic; margin: 8px 0; padding: 6px 10px; background: #f8fbff; border-left: 2px solid #1a5fb4; font-size: 0.88em; }
    @media print { .container { column-gap: 12px; } .block { box-shadow: none; } code, pre, table { font-size: 0.78em; } h1 { font-size: 1.4em; } h2 { font-size: 1em; } }
</style>
</head>
<body>
<div class="container">
  <h1>üé≤ Reservoir Sampling Cheatsheet</h1>
  <div class="subtitle">–°–ª—É—á–∞–π–Ω–æ–µ —Å–µ–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Ä¢ Streaming ‚Ä¢ –ê–ª–≥–æ—Ä–∏—Ç–º—ã<br>üìÖ –Ø–Ω–≤–∞—Ä—å 2026</div>

  <div class="block">
    <h2>üî∑ 1. –°—É—Ç—å</h2>
    <ul>
      <li><strong>Reservoir sampling</strong>: —Å–ª—É—á–∞–π–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞ –∏–∑ –ø–æ—Ç–æ–∫–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞</li>
      <li><strong>–ü–∞–º—è—Ç—å O(k)</strong>: —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ k —ç–ª–µ–º–µ–Ω—Ç–æ–≤</li>
      <li><strong>–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</strong>: –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é k/n</li>
      <li><strong>–û–¥–Ω –ø—Ä–æ—Ö–æ–¥</strong>: –Ω–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å —Ä–∞–∑–º–µ—Ä –∑–∞—Ä–∞–Ω–µ–µ</li>
      <li><strong>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ</strong>: streaming –¥–∞–Ω–Ω—ã–µ, –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã, SQL –∑–∞–ø—Ä–æ—Å—ã</li>
    </ul>
  </div>

  <div class="block">
    <h2>üî∑ 2. –ë–∞–∑–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º</h2>
    <p><strong>Algorithm R (Knuth):</strong></p>
    <ol>
      <li>–ó–∞–ø–æ–ª–Ω–∏—Ç—å reservoir –ø–µ—Ä–≤—ã–º–∏ k —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏</li>
      <li>–î–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ i (i > k): —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é k/i –∑–∞–º–µ–Ω–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ reservoir</li>
    </ol>
    
    <pre><code>import random

def reservoir_sampling(stream, k):
    """
    stream: –∏—Ç–µ—Ä–∞—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    k: —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏
    """
    reservoir = []
    
    for i, element in enumerate(stream):
        if i < k:
            # –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–≤—ã–µ k
            reservoir.append(element)
        else:
            # –ó–∞–º–µ–Ω–∞ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é k/i
            j = random.randint(0, i)
            if j < k:
                reservoir[j] = element
    
    return reservoir

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
stream = range(1000000)
sample = reservoir_sampling(stream, k=100)
print(f"Sampled {len(sample)} elements")</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 3. –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏</h2>
    <p><strong>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ i –ø–æ–ø–∞—Å—Ç—å –≤ –≤—ã–±–æ—Ä–∫—É:</strong></p>
    <pre><code>P(i –≤ –≤—ã–±–æ—Ä–∫–µ) = (k/i) * ‚àè(j=i+1 to n) (1 - 1/j)
                = (k/i) * (i/n) = k/n</code></pre>
    
    <p>–î–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–∞: k/n</p>
  </div>

  <div class="block">
    <h2>üî∑ 4. Weighted Reservoir Sampling</h2>
    <p><strong>–í—ã–±–æ—Ä–∫–∞ —Å –≤–µ—Å–∞–º–∏:</strong></p>
    <pre><code>import random
import math

def weighted_reservoir_sampling(stream, k):
    """
    stream: –∏—Ç–µ—Ä–∞—Ç–æ—Ä (element, weight)
    """
    reservoir = []
    
    for element, weight in stream:
        # Key = random^(1/weight)
        key = random.random() ** (1/weight)
        
        if len(reservoir) < k:
            reservoir.append((key, element))
            reservoir.sort(reverse=True)
        elif key > reservoir[-1][0]:
            reservoir[-1] = (key, element)
            reservoir.sort(reverse=True)
    
    return [elem for _, elem in reservoir]</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 5. Distributed Reservoir Sampling</h2>
    <p><strong>–ù–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∞—à–∏–Ω–∞—Ö:</strong></p>
    <ol>
      <li>–ö–∞–∂–¥–∞—è –º–∞—à–∏–Ω–∞ –¥–µ–ª–∞–µ—Ç reservoir sampling –ª–æ–∫–∞–ª—å–Ω–æ</li>
      <li>–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ reservoirs</li>
      <li>–°–¥–µ–ª–∞—Ç—å reservoir sampling –Ω–∞ –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</li>
    </ol>
    
    <pre><code># Map phase
def map_reservoir(partition, k):
    return reservoir_sampling(partition, k)

# Reduce phase
reservoirs = [map_reservoir(p, k) for p in partitions]
combined = [elem for r in reservoirs for elem in r]
final_sample = reservoir_sampling(combined, k)</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 6. Sliding Window Reservoir</h2>
    <p><strong>–° —É—á—ë—Ç–æ–º –≤—Ä–µ–º–µ–Ω–∏/–ø–æ—Ä—è–¥–∫–∞:</strong></p>
    <pre><code>from collections import deque
import time

class SlidingWindowReservoir:
    def __init__(self, k, window_size):
        self.k = k
        self.window_size = window_size
        self.window = deque(maxlen=window_size)
    
    def add(self, element):
        self.window.append(element)
        
    def sample(self):
        if len(self.window) <= self.k:
            return list(self.window)
        return random.sample(list(self.window), self.k)</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 7. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏—è</h2>
    <table>
      <tr><th>–û–±–ª–∞—Å—Ç—å</th><th>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ</th></tr>
      <tr><td>Database</td><td>Random sampling –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</td></tr>
      <tr><td>Networks</td><td>Monitoring –ø–∞–∫–µ—Ç–æ–≤</td></tr>
      <tr><td>Log analysis</td><td>–í—ã–±–æ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏–π –∏–∑ –ª–æ–≥–æ–≤</td></tr>
      <tr><td>ML</td><td>Downsampling –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤</td></tr>
      <tr><td>A/B testing</td><td>–í—ã–±–æ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</td></tr>
    </table>
  </div>

  <div class="block">
    <h2>üî∑ 8. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</h2>
    <ul>
      <li><strong>Algorithm L</strong>: –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã, O(k log(n/k))</li>
      <li><strong>Algorithm Z</strong>: –µ—â—ë –±—ã—Å—Ç—Ä–µ–µ, O(k(1 + log(n/k)))</li>
      <li><strong>Priority sampling</strong>: –¥–ª—è weighted —Å–ª—É—á–∞—è</li>
    </ul>
    
    <pre><code># Algorithm L - skip elements
def reservoir_l(stream, k):
    reservoir = []
    w = math.exp(math.log(random.random()) / k)
    
    for i, element in enumerate(stream):
        if i < k:
            reservoir.append(element)
        else:
            # Skip elements
            skip = math.floor(math.log(random.random()) / math.log(1-w))
            # Implementation continues...</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 9. Variance Estimation</h2>
    <p><strong>–û—Ü–µ–Ω–∫–∞ –¥–∏—Å–ø–µ—Ä—Å–∏–∏ –≤—ã–±–æ—Ä–∫–∏:</strong></p>
    <pre><code>import numpy as np

def reservoir_with_stats(stream, k):
    reservoir = []
    n = 0
    sum_x = 0
    sum_x2 = 0
    
    for element in stream:
        n += 1
        sum_x += element
        sum_x2 += element**2
        
        if n <= k:
            reservoir.append(element)
        else:
            j = random.randint(0, n-1)
            if j < k:
                reservoir[j] = element
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    mean = sum_x / n
    variance = (sum_x2 / n) - mean**2
    
    return reservoir, mean, variance</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 10. –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</h2>
    <div class="good-vs-bad">
      <div class="good">
        <h3>‚úÖ –•–æ—Ä–æ—à–æ</h3>
        <ul>
          <li>Streaming –¥–∞–Ω–Ω—ã–µ</li>
          <li>–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ—Ç–æ–∫–∞</li>
          <li>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å</li>
          <li>–ù—É–∂–Ω–∞ —Å–ª—É—á–∞–π–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞</li>
          <li>–û–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥ –ø–æ –¥–∞–Ω–Ω—ã–º</li>
        </ul>
      </div>
      <div class="bad">
        <h3>‚ùå –ü–ª–æ—Ö–æ</h3>
        <ul>
          <li>–î–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏ —Ü–µ–ª–∏–∫–æ–º</li>
          <li>–ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ö–æ–¥–æ–≤</li>
          <li>–ù—É–∂–Ω–∞ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="block">
    <h2>üî∑ 11. –ß–µ–∫-–ª–∏—Å—Ç</h2>
    <ul>
      <li>[ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ k</li>
      <li>[ ] –í—ã–±—Ä–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º (–ø—Ä–æ—Å—Ç–æ–π, weighted, distributed)</li>
      <li>[ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</li>
      <li>[ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å memory footprint</li>
      <li>[ ] –û—Ü–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≤—ã–±–æ—Ä–∫–∏</li>
      <li>[ ] –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å sliding window –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö</li>
    </ul>

    <h3>üí° –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑—á–∏–∫—É:</h3>
    <blockquote>
      ¬´Reservoir sampling ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å —Å–ª—É—á–∞–π–Ω—É—é –≤—ã–±–æ—Ä–∫—É –∏–∑ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ–≥–¥–∞ –º—ã –Ω–µ –∑–Ω–∞–µ–º 
      –∑–∞—Ä–∞–Ω–µ–µ, —Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –±—É–¥–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ 100 —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–∏—Å–µ–º –∏–∑ –ø–æ—á—Ç—ã, 
      –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è. –ê–ª–≥–æ—Ä–∏—Ç–º –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–∞–∂–¥–æ–µ –ø–∏—Å—å–º–æ –∏–º–µ–µ—Ç —Ä–∞–≤–Ω—ã–µ —à–∞–Ω—Å—ã –ø–æ–ø–∞—Å—Ç—å –≤ –≤—ã–±–æ—Ä–∫—É¬ª.
    </blockquote>
  </div>

</div>
</body>
</html>