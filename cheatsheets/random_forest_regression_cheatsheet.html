<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Random Forest –¥–ª—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ Cheatsheet ‚Äî 3 –∫–æ–ª–æ–Ω–∫–∏</title>
  <style>
    @media screen { body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; color: #333; background: #fafcff; padding: 10px; }}
    .container { column-count: 3; column-gap: 20px; max-width: 100%; }
    .block { break-inside: avoid; margin-bottom: 1.2em; padding: 12px; background: white; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    h1 { font-size: 1.6em; font-weight: 700; color: #1a5fb4; text-align: center; margin: 0 0 8px; column-span: all; }
    .subtitle { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 12px; column-span: all; }
    h2 { font-size: 1.15em; font-weight: 700; color: #1a5fb4; margin: 0 0 8px; padding-bottom: 4px; border-bottom: 1px solid #e0e7ff; }
    p, ul, ol { font-size: 0.92em; margin: 0.6em 0; }
    ul, ol { padding-left: 18px; }
    li { margin-bottom: 4px; }
    code { font-family: 'Consolas', 'Courier New', monospace; background-color: #f0f4ff; padding: 1px 4px; border-radius: 3px; font-size: 0.88em; }
    pre { background-color: #f0f4ff; padding: 8px; border-radius: 4px; overflow-x: auto; font-size: 0.84em; margin: 6px 0; }
    pre code { padding: 0; background: none; white-space: pre-wrap; }
    table { width: 100%; border-collapse: collapse; font-size: 0.82em; margin: 6px 0; }
    th { background-color: #e6f0ff; text-align: left; padding: 4px 6px; font-weight: 600; }
    td { padding: 4px 6px; border-bottom: 1px solid #f0f4ff; }
    tr:nth-child(even) { background-color: #f8fbff; }
  </style>
</head>
<body>
<div class="container">
  <h1>üéØ Random Forest –¥–ª—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏</h1>
  <div class="subtitle"></div>

  <div class="block">
    <h2>üî∑ 1. –°—É—Ç—å</h2>
    <ul>
      <li><strong>–¢–∏–ø</strong>: –∞–Ω—Å–∞–º–±–ª—å –¥–µ—Ä–µ–≤—å–µ–≤ —Ä–µ—à–µ–Ω–∏–π</li>
      <li><strong>Bagging</strong>: –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ bootstrap –≤—ã–±–æ—Ä–∫–∞—Ö</li>
      <li><strong>–°–ª—É—á–∞–π–Ω–æ—Å—Ç—å</strong>: —Å–ª—É—á–∞–π–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤ –∫–∞–∂–¥–æ–º —É–∑–ª–µ</li>
      <li><strong>–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ</strong>: —Å—Ä–µ–¥–Ω–µ–µ –ø–æ –≤—Å–µ–º –¥–µ—Ä–µ–≤—å—è–º</li>
    </ul>
  </div>

  <div class="block">
    <h2>üî∑ 2. –ë–∞–∑–æ–≤—ã–π –∫–æ–¥</h2>
    <pre><code>from sklearn.ensemble import RandomForestRegressor

rf = RandomForestRegressor(
    n_estimators=100,
    max_depth=None,
    min_samples_split=2,
    min_samples_leaf=1,
    max_features='sqrt',
    random_state=42,
    n_jobs=-1
)

rf.fit(X_train, y_train)
y_pred = rf.predict(X_test)

# –û—Ü–µ–Ω–∫–∞
from sklearn.metrics import mean_squared_error, r2_score
print(f"RMSE: {np.sqrt(mean_squared_error(y_test, y_pred)):.3f}")
print(f"R¬≤: {r2_score(y_test, y_pred):.3f}")</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 3. –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
    <table>
      <tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th><th>–≠—Ñ—Ñ–µ–∫—Ç</th></tr>
      <tr><td><code>n_estimators</code></td><td>100-500</td><td>–ë–æ–ª—å—à–µ = —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ, –º–µ–¥–ª–µ–Ω–Ω–µ–µ</td></tr>
      <tr><td><code>max_depth</code></td><td>None/10-30</td><td>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã –¥–µ—Ä–µ–≤—å–µ–≤</td></tr>
      <tr><td><code>max_features</code></td><td>'sqrt'</td><td>–°–ª—É—á–∞–π–Ω–æ—Å—Ç—å –ø—Ä–∏ split</td></tr>
      <tr><td><code>min_samples_split</code></td><td>2-20</td><td>–†–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è</td></tr>
      <tr><td><code>bootstrap</code></td><td>True</td><td>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å bootstrap</td></tr>
    </table>
  </div>

  <div class="block">
    <h2>üî∑ 4. Feature Importance</h2>
    <pre><code>importances = rf.feature_importances_
indices = np.argsort(importances)[::-1]

# –¢–æ–ø-10 –≤–∞–∂–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
for i in range(min(10, len(importances))):
    print(f"{i+1}. {feature_names[indices[i]]}: {importances[indices[i]]:.4f}")

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
import matplotlib.pyplot as plt
plt.figure(figsize=(10, 6))
plt.bar(range(len(importances)), importances[indices])
plt.xlabel('–ü—Ä–∏–∑–Ω–∞–∫')
plt.ylabel('Importance')
plt.title('Feature Importances')
plt.show()</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 5. –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤</h2>
    <pre><code># –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –≤—Å–µ—Ö –¥–µ—Ä–µ–≤—å–µ–≤
predictions = np.array([tree.predict(X_test) for tree in rf.estimators_])

# –°—Ä–µ–¥–Ω–µ–µ –∏ —Å—Ç–¥
mean_pred = predictions.mean(axis=0)
std_pred = predictions.std(axis=0)

# 95% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
lower = mean_pred - 1.96 * std_pred
upper = mean_pred + 1.96 * std_pred

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
plt.figure(figsize=(12, 6))
plt.plot(y_test, label='True', alpha=0.7)
plt.plot(mean_pred, label='Predicted', alpha=0.7)
plt.fill_between(range(len(mean_pred)), lower, upper, alpha=0.3, label='95% CI')
plt.legend()
plt.show()</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 6. –ü–æ–¥–±–æ—Ä –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</h2>
    <pre><code>from sklearn.model_selection import RandomizedSearchCV

param_dist = {
    'n_estimators': [100, 200, 500],
    'max_depth': [10, 20, 30, None],
    'min_samples_split': [2, 5, 10],
    'min_samples_leaf': [1, 2, 4],
    'max_features': ['sqrt', 'log2', None]
}

search = RandomizedSearchCV(
    RandomForestRegressor(random_state=42),
    param_dist,
    n_iter=50,
    cv=5,
    scoring='neg_mean_squared_error',
    n_jobs=-1
)

search.fit(X_train, y_train)
print(f"Best params: {search.best_params_}")
best_rf = search.best_estimator_</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 7. –ö—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è</h2>
    <pre><code>from sklearn.model_selection import cross_val_score

scores = cross_val_score(
    rf, X, y,
    cv=5,
    scoring='neg_mean_squared_error',
    n_jobs=-1
)

rmse_scores = np.sqrt(-scores)
print(f"RMSE: {rmse_scores.mean():.3f} (+/- {rmse_scores.std():.3f})")</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 8. Out-of-Bag (OOB) –æ—Ü–µ–Ω–∫–∞</h2>
    <pre><code>rf_oob = RandomForestRegressor(
    n_estimators=100,
    oob_score=True,
    random_state=42
)

rf_oob.fit(X_train, y_train)
print(f"OOB Score (R¬≤): {rf_oob.oob_score_:.3f}")

# OOB –ø–æ—Ö–æ–∂ –Ω–∞ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—é, –Ω–æ –±—ã—Å—Ç—Ä–µ–µ
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ –≤–æ—à–µ–¥—à–∏–µ –≤ bootstrap –¥–∞–Ω–Ω—ã–µ</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 9. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ–¥–Ω–∏–º –¥–µ—Ä–µ–≤–æ–º</h2>
    <pre><code>from sklearn.tree import DecisionTreeRegressor

# –û–¥–Ω–æ –¥–µ—Ä–µ–≤–æ
tree = DecisionTreeRegressor(random_state=42)
tree.fit(X_train, y_train)
tree_score = r2_score(y_test, tree.predict(X_test))

# Random Forest
rf_score = r2_score(y_test, rf.predict(X_test))

print(f"Decision Tree R¬≤: {tree_score:.3f}")
print(f"Random Forest R¬≤: {rf_score:.3f}")
# RF –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –ª—É—á—à–µ!</code></pre>
  </div>

  <div class="block">
    <h2>üî∑ 10. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</h2>
    <ul>
      <li>–†–µ–¥–∫–æ –ø–µ—Ä–µ–æ–±—É—á–∞–µ—Ç—Å—è</li>
      <li>–ù–µ —Ç—Ä–µ–±—É–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è</li>
      <li>–†–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–æ–ø—É—Å–∫–∞–º–∏ (—á–µ—Ä–µ–∑ surrogates)</li>
      <li>Feature importance –≤—Å—Ç—Ä–æ–µ–Ω</li>
      <li>–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ</li>
      <li>–†–æ–±–∞—Å—Ç–Ω–æ—Å—Ç—å –∫ –≤—ã–±—Ä–æ—Å–∞–º</li>
    </ul>
  </div>

  <div class="block">
    <h2>üî∑ 11. –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏</h2>
    <ul>
      <li>–ú–µ–¥–ª–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ (–º–Ω–æ–≥–æ –¥–µ—Ä–µ–≤—å–µ–≤)</li>
      <li>–ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏</li>
      <li>–•—É–∂–µ —ç–∫—Å—Ç—Ä–∞–ø–æ–ª–∏—Ä—É–µ—Ç</li>
      <li>–°–ª–æ–∂–Ω–µ–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å</li>
      <li>–ú–æ–∂–µ—Ç –±—ã—Ç—å —Ö—É–∂–µ gradient boosting</li>
    </ul>
  </div>

  <div class="block">
    <h2>üî∑ 12. –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏</h2>
    <ul>
      <li><strong>n_estimators</strong>: –Ω–∞—á–Ω–∏—Ç–µ —Å 100, —É–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ –¥–æ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏</li>
      <li><strong>max_features</strong>: 'sqrt' –¥–ª—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏</li>
      <li><strong>OOB score</strong>: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ—Ü–µ–Ω–∫–∏</li>
      <li><strong>–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º</strong>: n_jobs=-1 –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è</li>
      <li><strong>–ü–∞–º—è—Ç—å</strong>: warm_start=True –¥–ª—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è</li>
    </ul>
  </div>

</div>
</body>
</html>
